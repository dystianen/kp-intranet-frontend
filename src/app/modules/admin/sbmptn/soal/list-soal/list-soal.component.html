<div
    id="soal"
    class="sm:absolute sm:inset-0 flex flex-col flex-auto min-w-0 sm:overflow-scroll bg-card dark:bg-transparent"
>
    <!-- Header -->
    <div
        class="relative flex flex-col sm:flex-row flex-0 sm:items-center sm:justify-between py-8 px-6 md:px-8 border-b"
    >
        <!-- Loader -->
        <!-- <div class="absolute inset-x-0 bottom-0">
            <mat-progress-bar [mode]="'indeterminate'"></mat-progress-bar>
        </div> -->
        <!-- Title -->
        <div class="text-4xl font-extrabold tracking-tight">
            SBMPTN - Soal Repository
        </div>
        <!-- Actions -->
        <div class="flex flex-shrink-0 items-center mt-6 sm:mt-0 sm:ml-4">
            <back-button></back-button>
            <button
                class="ml-4"
                mat-flat-button
                [color]="'primary'"
                (click)="add()"
            >
                <mat-icon [svgIcon]="'heroicons_outline:plus'"></mat-icon>
                <span class="ml-2 mr-1">Add</span>
            </button>
            <button
                class="ml-4"
                mat-flat-button
                [color]="'primary'"
                (click)="onModalUpload()"
            >
                <mat-icon [svgIcon]="'file_copy'"></mat-icon>
                <span class="ml-2 mr-1">Bulk Upload</span>
            </button>
        </div>
    </div>

    <div class="m-4">
        <div class="flex justify-between items-center">
            <div>
                <section>
                    <mat-checkbox [(ngModel)]="readMode"
                        >Mode Baca</mat-checkbox
                    >
                </section>
            </div>
            <div>
                <section>
                    <ng-container
                        *ngFor="let item of categories; let i = index"
                    >
                        <span class="ml-3">
                            <mat-checkbox
                                [value]="item.id"
                                #chk2
                                [checked]="checkCategory(item.id)"
                                (change)="handleChangeCategory(chk2)"
                                >{{ item.category }}</mat-checkbox
                            >
                        </span>
                    </ng-container>
                </section>
            </div>
        </div>
        <hr />
        <ng-container *ngIf="readMode == true">
            <ng-container *ngIf="soals">
                <ng-container *ngFor="let item of soals; let i = index">
                    <div class="my-2">
                        <div class="flex">
                            <span
                                ><b>{{ i + 1 }}</b
                                >.</span
                            >
                            <span
                                class="ml-2"
                                [innerHTML]="item.instruction +'<br>' + item.content"
                            ></span>
                        </div>
                        <div class="flex flex-col pt-2 pl-10">
                            <ol class="">
                                <ng-container *ngFor="let jwb of item.jawaban">
                                    <ng-container *ngIf="jwb.is_true == true">
                                        <li class="flex text-red-700 font-bold">
                                            <span class="font-bold"
                                                >{{ jwb.key }}.</span
                                            >
                                            <span
                                                class="ml-2"
                                                [innerHTML]="jwb.content"
                                            ></span>
                                        </li>
                                    </ng-container>
                                    <ng-container *ngIf="jwb.is_true == false">
                                        <li class="flex">
                                            <span class="font-bold"
                                                >{{ jwb.key }}.</span
                                            >
                                            <span
                                                class="ml-2"
                                                [innerHTML]="jwb.content"
                                            ></span>
                                        </li>
                                    </ng-container>
                                </ng-container>
                            </ol>
                        </div>
                    </div>
                </ng-container>
            </ng-container>
        </ng-container>
        <ng-container *ngIf="readMode == false">
            <table mat-table [dataSource]="dataSource" class="w-full" matSort>
                <ng-container matColumnDef="no">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>
                        No
                    </th>
                    <td mat-cell *matCellDef="let element; let i = index">
                        <ng-container
                            *ngIf="!checkHasJawabanSelected(element.id)"
                        >
                            <mat-icon
                                class="text-red-600"
                                [svgIcon]="'warning'"
                            ></mat-icon>
                        </ng-container>
                        <ng-container
                            *ngIf="checkHasJawabanSelected(element.id)"
                        >
                            {{ i + 1 }}
                        </ng-container>
                    </td>
                </ng-container>

                <ng-container matColumnDef="id">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>
                        ID
                    </th>
                    <td mat-cell *matCellDef="let element">
                        #{{ element.id }}
                    </td>
                </ng-container>

                <ng-container matColumnDef="category">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>
                        Category
                    </th>
                    <td mat-cell *matCellDef="let element">
                        <div class="flex items-center">
                            <ng-container
                                *ngIf="element.category_id === 'latihan_soal'"
                            >
                                <span
                                    class="p-1 text-white"
                                    [style]="
                                        'background-color:' +
                                        element.category?.color +
                                        ';'
                                    "
                                    >{{ element.category?.category }}</span
                                >
                            </ng-container>
                            <ng-container
                                *ngIf="element.category_id === 'tryout'"
                            >
                                <span
                                    class="p-1 text-white"
                                    [style]="
                                        'background-color:' +
                                        element.category?.color +
                                        ';'
                                    "
                                    >{{ element.category?.category }}</span
                                >
                            </ng-container>
                        </div>
                    </td>
                </ng-container>

                <ng-container matColumnDef="type">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>
                        Type
                    </th>
                    <td mat-cell *matCellDef="let element">
                        {{ element.tryout_type?.title }}
                    </td>
                </ng-container>

                <ng-container matColumnDef="module">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>
                        Module
                    </th>
                    <td mat-cell *matCellDef="let element">
                        {{ element.module?.name }}
                        {{ element.tryout_module?.name }}
                    </td>
                </ng-container>

                <ng-container matColumnDef="mapel">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>
                        Mapel
                    </th>
                    <td mat-cell *matCellDef="let element">
                        {{ element.mapel?.mapel_name }}
                        {{ element.tryout_subtopic?.name }}
                    </td>
                </ng-container>

                <ng-container matColumnDef="subtopic">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>
                        Subtopic
                    </th>
                    <td mat-cell *matCellDef="let element">
                        {{ element.tryout_subtopic?.name }}
                    </td>
                </ng-container>

                <ng-container matColumnDef="title">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>
                        Soal
                    </th>
                    <td mat-cell *matCellDef="let element">
                        <div
                            [innerHTML]="element.content | slice : 0 : 120"
                        ></div>
                    </td>
                </ng-container>

                <ng-container matColumnDef="options">
                    <th mat-header-cell *matHeaderCellDef class="text-right">
                        Edit
                    </th>
                    <td mat-cell *matCellDef="let element">
                        <div class="flex justify-end">
                            <button
                                class="min-w-10 min-h-7 h-7 px-2 leading-6 text-blue-800"
                                (click)="edit(element.uuid)"
                            >
                                <span class="material-icons"> edit </span>
                            </button>
                        </div>
                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr
                    mat-row
                    *matRowDef="let row; columns: displayedColumns"
                ></tr>
            </table>
        </ng-container>
    </div>
</div>
